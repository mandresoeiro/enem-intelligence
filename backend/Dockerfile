# ==========================================================
# üêç Backend ‚Äî Django + DRF + Poetry
# ==========================================================
FROM python:3.12-slim

# Vari√°veis de ambiente b√°sicas
ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONUNBUFFERED=1

# Diret√≥rio de trabalho
WORKDIR /app

# Instala depend√™ncias do sistema
RUN apt-get update && apt-get install -y build-essential libpq-dev curl

# Instala o Poetry
RUN pip install poetry

# Copia arquivos do Poetry e instala depend√™ncias
COPY pyproject.toml poetry.lock* ./
# Garante que o lock esteja atualizado com o pyproject (inclui novas deps como pandas)
RUN poetry lock --no-interaction && poetry install --no-root --no-interaction

# Copia o restante do backend
COPY . .

# Exp√µe a porta padr√£o do Django
EXPOSE 8000

# Comando padr√£o
CMD ["poetry", "run", "python", "manage.py", "runserver", "0.0.0.0:8000"]
